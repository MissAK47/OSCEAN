# OSCEAN项目架构图集

本文档包含OSCEAN项目的完整架构图集，展示了系统的总体架构和各个核心模块的详细设计。

## 1. 总体功能架构图

第一张图展示了OSCEAN系统的总体架构，包含以下层次：

- **客户端层**: 支持Web客户端(Cesium)、桌面应用和API客户端
- **网络服务层**: 基于Boost.Beast的HTTP/WebSocket服务器
- **工作流引擎层**: 核心的任务调度和工作流执行引擎
- **输出生成层**: 可视化、瓦片服务和数据导出功能
- **核心服务层**: 六大核心服务（数据访问、元数据、空间操作、坐标系统、插值、建模）
- **通用工具层**: 底层基础设施（线程池、SIMD、GPU、缓存等）
- **数据存储层**: 各种数据格式和数据库支持

### 架构特点：
- 清晰的分层设计，各层职责明确
- 自下而上的依赖关系
- 模块间低耦合，通过接口通信

## 2. 核心服务层详细架构

第二张图详细展示了核心服务层的六个服务内部架构：

### Data Access Service（数据访问服务）
- 支持多种数据格式（NetCDF、GDAL/OGR、HDF5）
- 统一的读取接口和异步引擎
- 读取器池管理，优化并发性能

### Metadata Service（元数据服务）
- 基于SQLite的高效存储
- 多种索引支持（空间R*Tree、全文FTS5）
- 智能查询优化和缓存

### Spatial Ops Service（空间操作服务）
- 几何和栅格双引擎
- 空间索引管理
- 裁剪、镶嵌、缓冲区等操作

### CRS Service（坐标系统服务）
- PROJ库封装
- 坐标转换缓存
- 批量转换优化

### Interpolation Service（插值服务）
- CPU和GPU双模式
- SIMD优化
- 智能策略选择

### Modeling Service（建模服务）
- RAM声学模型集成
- USML库支持
- 模型注册和参数验证

## 3. 工作流引擎详细架构

第三张图展示了工作流引擎的核心组件：

### Service Management（服务管理）
- 服务注册和工厂模式
- 生命周期管理
- 依赖解析

### Workflow Execution（工作流执行）
- 任务队列和执行上下文
- 状态管理和进度跟踪
- 错误处理机制

### Task Dispatching（任务调度）
- 优先级队列
- 负载均衡
- 资源监控

### Strategy Engine（策略引擎）
- 文件特征分析
- 性能预测
- 自适应策略选择

### Data Workflow Service（数据工作流服务）
- 请求解析和数据源发现
- 处理流水线
- 结果缓存

### Async Framework（异步框架）
- Future/Promise管理
- 任务链构建
- 取消管理

## 4. 输出生成层详细架构

第四张图展示了输出生成层的各个组件：

### Visualization Engine（可视化引擎）
- 颜色映射和等值线生成
- 图例和比例尺
- 多种渲染管道

### GPU Acceleration（GPU加速）
- CUDA核心管理
- 内存池和流管理
- 纹理缓存优化

### Tile Service（瓦片服务）
- 瓦片生成和缓存（LRU）
- 金字塔构建
- GDAL Warp重投影

### Data Export Engine（数据导出引擎）
- 多格式写入器
- 压缩和分块写入
- 元数据嵌入

### Format Writers（格式写入器）
- 支持NetCDF、GeoTIFF、PNG/JPEG
- CSV/TXT文本格式
- KML/GeoJSON矢量格式

### Render Backends（渲染后端）
- 软件渲染器
- CUDA加速渲染
- OpenGL支持

## 5. 数据处理流水线

第五张图展示了完整的数据处理流程：

1. **请求解析**: 解析空间、时间、变量等查询条件
2. **元数据查询**: 发现匹配的数据源
3. **策略选择**: 根据数据特征选择处理策略
   - 小数据集：缓存优化
   - 大数据集：流式处理
   - 多变量：并行读取
   - 时间序列：序列优化
4. **数据读取**: 执行实际的数据读取
5. **数据处理**: 坐标转换、空间裁剪、数据融合、插值
6. **输出生成**: 根据请求格式生成输出

## 6. 网络服务层详细架构

第六张图展示了网络服务层的设计：

### Network Core（网络核心）
- 基于Boost.Asio的IO Context
- IO线程池和工作线程池分离

### Connection Management（连接管理）
- 监听器和接受器
- HTTP和WebSocket连接
- 连接池管理

### Request Processing（请求处理）
- 路由注册和管理
- Boost.Beast请求解析
- 中间件链支持

### Response Handling（响应处理）
- 响应构建和序列化
- 压缩支持
- 分块传输和流式写入

### Protocol Support（协议支持）
- HTTP/1.1和HTTP/2
- WebSocket全双工通信
- Server-Sent Events

### Security & Utils（安全和工具）
- SSL/TLS加密
- 认证和限流
- CORS和错误处理

## 7. 通用工具层详细架构

第七张图展示了底层基础设施：

### Thread Pool Management（线程池管理）
- 统一的线程池管理器
- CPU密集型、IO密集型、计算密集型池
- 任务队列和工作线程

### SIMD Operations（SIMD操作）
- AVX2/AVX512指令集支持
- SSE4降级支持
- 自动向量化

### GPU Management（GPU管理）
- CUDA上下文管理
- 设备内存池
- 核函数注册和流调度

### Cache System（缓存系统）
- LRU、LFU、TTL多种策略
- 分布式缓存接口
- 缓存统计

### Memory Management（内存管理）
- 内存池和对齐分配器
- 大页支持
- 内存跟踪和泄漏检测

### Logging & Monitoring（日志和监控）
- 基于spdlog的日志系统
- 性能监控和指标收集
- 跟踪和调试工具

## 8. 插值服务详细架构

第八张图展示了插值服务的内部设计：

### 核心组件
- 统一的服务接口
- 智能策略选择器
- CPU和GPU双引擎
- 批处理支持
- 性能优化特性

### 特色功能
- 自动设备选择（CPU/GPU）
- SIMD优化的CPU实现
- CUDA纹理内存优化
- 自适应性能调优

## 9. 元数据服务详细架构

第九张图展示了元数据服务的设计：

### 核心功能
- 多格式元数据提取
- SQLite高效存储
- 多维度索引系统
- 智能查询处理
- 高级管理功能

### 索引系统
- 空间索引（R*Tree）
- 时间索引（B+Tree）
- 全文索引（FTS5）
- 变量和组合索引

## 架构设计总结

OSCEAN项目的架构设计体现了以下优秀特点：

1. **模块化**: 清晰的模块边界和接口定义
2. **分层设计**: 自下而上的依赖关系，层次分明
3. **性能优化**: GPU加速、SIMD优化、异步处理
4. **可扩展性**: 插件式架构，易于添加新功能
5. **专业性**: 深度集成海洋科学计算需求

这些架构图为开发人员提供了清晰的系统全貌，有助于理解系统设计和进行后续开发维护。 