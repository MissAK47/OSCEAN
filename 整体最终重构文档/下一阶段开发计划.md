# OSCEAN ä¸‹ä¸€é˜¶æ®µå¼€å‘è®¡åˆ’

## å½“å‰çŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆæ¨¡å—
- **ç¬¬5å±‚ - å…±äº«åŸºç¡€åº“** (`common_utils`): çº¿ç¨‹æ± ã€æ—¥å¿—ã€é…ç½®ç®¡ç†ç­‰
- **ç¬¬3å±‚ - æ ¸å¿ƒæœåŠ¡å±‚** (`core_services`): æ•°æ®è®¿é—®ã€å…ƒæ•°æ®ã€ç©ºé—´å¤„ç†ã€æ’å€¼ã€CRSè½¬æ¢ç­‰

### ğŸš§ éƒ¨åˆ†å®Œæˆæ¨¡å—
- **ç¬¬4å±‚ - è¾“å‡ºç”Ÿæˆå±‚** (`output_generation`): ç“¦ç‰‡æœåŠ¡æ¡†æ¶å·²æ­å»º
- **ç¬¬2å±‚ - ä»»åŠ¡è°ƒåº¦å±‚** (`workflow_engine`, `task_dispatcher`): åŸºç¡€æ¡†æ¶å­˜åœ¨
- **ç¬¬1å±‚ - ç½‘ç»œæœåŠ¡å±‚** (`network_service`): HTTPæœåŠ¡æ¡†æ¶å­˜åœ¨

## ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šå®Œæˆç¬¬2å±‚ï¼ˆä»»åŠ¡è°ƒåº¦ä¸å·¥ä½œæµå¼•æ“ï¼‰

### ç›®æ ‡
å®ç°å®Œæ•´çš„ä»»åŠ¡è°ƒåº¦å’Œå·¥ä½œæµç¼–æ’èƒ½åŠ›ï¼Œä¸ºæµ·æ´‹æ•°æ®è‡ªåŠ¨ç®¡ç†æä¾›åŸºç¡€ã€‚

### å…·ä½“ä»»åŠ¡

#### 1. å®Œå–„ TaskDispatcher å®ç°
```cpp
// éœ€è¦å®ç°çš„æ ¸å¿ƒæ¥å£
class TaskDispatcherImpl : public TaskDispatcher {
public:
    void processApiRequest(NetworkService::RequestDTO request,
                          std::function<void(NetworkService::ResponseData)> callback) override;
    
    // ä¸“é—¨çš„æ•°æ®ç®¡ç†å·¥ä½œæµå…¥å£
    void processDataManagementRequest(NetworkService::RequestDTO request,
                                    std::function<void(NetworkService::ResponseData)> callback);
};
```

#### 2. å®ç°æµ·æ´‹æ•°æ®è‡ªåŠ¨ç®¡ç†å·¥ä½œæµ
åŸºäºç°æœ‰çš„ `ocean_data_indexer.cpp`ï¼Œåˆ›å»ºå·¥ä½œæµå®šä¹‰ï¼š

```cpp
// workflow_engine/src/definition/blueprints/data_management_workflow.cpp
class DataManagementWorkflow : public IWorkflowDefinition {
    // æ­¥éª¤ï¼š
    // 1. æ‰«ææ•°æ®ç›®å½•
    // 2. æå–å…ƒæ•°æ®
    // 3. æ•°æ®è´¨é‡æ£€æŸ¥
    // 4. æ›´æ–°ç´¢å¼•æ•°æ®åº“
    // 5. ç”ŸæˆæŠ¥å‘Š
};
```

#### 3. é›†æˆæ ¸å¿ƒæœåŠ¡è°ƒç”¨
```cpp
// workflow_engine/src/proxy/core_service_proxy.cpp
class CoreServiceProxy {
public:
    std::future<StepResultData> scanDataDirectory(const std::string& path);
    std::future<StepResultData> extractMetadata(const std::vector<std::string>& files);
    std::future<StepResultData> updateMetadataIndex(const MetadataCollection& metadata);
};
```

### å®æ–½æ­¥éª¤

#### é˜¶æ®µ1ï¼šåŸºç¡€æ¡†æ¶å®Œå–„ï¼ˆ1-2å‘¨ï¼‰
1. **å®Œå–„ TaskDispatcher å®ç°**
   - å®ç°è¯·æ±‚è·¯ç”±é€»è¾‘
   - é›†æˆå·¥ä½œæµå¼•æ“è°ƒç”¨
   - æ·»åŠ é”™è¯¯å¤„ç†æœºåˆ¶

2. **å®Œå–„ WorkflowExecutor**
   - ä¿®å¤ç°æœ‰çš„å¼‚æ­¥æ‰§è¡Œé€»è¾‘
   - å®Œå–„æ­¥éª¤ä¾èµ–ç®¡ç†
   - æ·»åŠ å·¥ä½œæµçŠ¶æ€è·Ÿè¸ª

#### é˜¶æ®µ2ï¼šæ•°æ®ç®¡ç†å·¥ä½œæµå®ç°ï¼ˆ2-3å‘¨ï¼‰
1. **åˆ›å»ºæ•°æ®ç®¡ç†å·¥ä½œæµå®šä¹‰**
   ```
   workflow_engine/src/definition/blueprints/
   â”œâ”€â”€ data_management_workflow.h
   â”œâ”€â”€ data_management_workflow.cpp
   â””â”€â”€ workflow_registry.cpp  # æ³¨å†Œå·¥ä½œæµ
   ```

2. **å®ç°æ ¸å¿ƒæœåŠ¡ä»£ç†**
   ```
   workflow_engine/src/proxy/
   â”œâ”€â”€ core_service_proxy.h
   â”œâ”€â”€ core_service_proxy.cpp
   â””â”€â”€ data_management_proxy.cpp  # ä¸“é—¨çš„æ•°æ®ç®¡ç†ä»£ç†
   ```

3. **é›†æˆç°æœ‰çš„æ•°æ®ç´¢å¼•åŠŸèƒ½**
   - å°† `ocean_data_indexer.cpp` çš„é€»è¾‘æ‹†åˆ†ä¸ºå·¥ä½œæµæ­¥éª¤
   - æ¯ä¸ªæ­¥éª¤ä½œä¸ºç‹¬ç«‹çš„å¯æ‰§è¡Œå•å…ƒ
   - æ”¯æŒå¼‚æ­¥æ‰§è¡Œå’Œè¿›åº¦æŠ¥å‘Š

#### é˜¶æ®µ3ï¼šç½‘ç»œæ¥å£é›†æˆï¼ˆ1å‘¨ï¼‰
1. **æ·»åŠ æ•°æ®ç®¡ç†APIç«¯ç‚¹**
   ```cpp
   // åœ¨ RequestRouter ä¸­æ·»åŠ è·¯ç”±
   router->addRoute(http::verb::post, "/api/data/scan", 
       [dispatcher](RequestDTO dto, auto cb) {
           dispatcher->processDataManagementRequest(std::move(dto), std::move(cb));
       });
   ```

2. **å®ç°RESTful API**
   - `POST /api/data/scan` - å¯åŠ¨æ•°æ®æ‰«æ
   - `GET /api/data/scan/{id}` - æŸ¥è¯¢æ‰«æçŠ¶æ€
   - `GET /api/data/reports` - è·å–æ‰«ææŠ¥å‘Š

## ç¬¬äºŒä¼˜å…ˆçº§ï¼šå®Œå–„ç¬¬4å±‚ï¼ˆè¾“å‡ºç”Ÿæˆå±‚ï¼‰

### ç›®æ ‡
å®Œæˆç“¦ç‰‡æœåŠ¡çš„å®ç°ï¼Œæ”¯æŒæµ·æ´‹æ•°æ®å¯è§†åŒ–ã€‚

### å…·ä½“ä»»åŠ¡

#### 1. å®Œå–„ç“¦ç‰‡æœåŠ¡å®ç°
- å®Œæˆ `TileService::handleTileRequest` çš„å®ç°
- é›†æˆç¼“å­˜æœºåˆ¶
- å®ç°æ …æ ¼ç“¦ç‰‡æ¸²æŸ“

#### 2. é›†æˆæ•°æ®è®¿é—®
- è¿æ¥ç¬¬3å±‚çš„æ•°æ®è®¿é—®æœåŠ¡
- å®ç°æ•°æ®åˆ°ç“¦ç‰‡çš„è½¬æ¢æµç¨‹

## ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå®Œå–„ç¬¬1å±‚ï¼ˆç½‘ç»œæœåŠ¡å±‚ï¼‰

### ç›®æ ‡
å®ŒæˆHTTPæœåŠ¡å™¨çš„å®Œæ•´å®ç°å’Œé›†æˆã€‚

### å…·ä½“ä»»åŠ¡

#### 1. å®Œå–„ç½‘ç»œæœåŠ¡é›†æˆ
- å®Œæˆ `NetworkServer` ä¸ `TaskDispatcher` çš„é›†æˆ
- æ·»åŠ é…ç½®ç®¡ç†
- å®ç°ä¼˜é›…å…³é—­æœºåˆ¶

#### 2. æ·»åŠ ç®¡ç†ç•Œé¢æ”¯æŒ
- é™æ€æ–‡ä»¶æœåŠ¡
- WebSocketæ”¯æŒï¼ˆç”¨äºå®æ—¶çŠ¶æ€æ›´æ–°ï¼‰

## æµ·æ´‹ç¯å¢ƒæ•°æ®è‡ªåŠ¨ç®¡ç†åŠŸèƒ½è®¾è®¡

### åŠŸèƒ½å®šä½
**å±äºç¬¬2å±‚çš„å·¥ä½œæµåº”ç”¨**ï¼Œä¸æ˜¯ç‹¬ç«‹çš„appï¼Œè€Œæ˜¯ç³»ç»Ÿå†…ç½®çš„æ•°æ®ç®¡ç†å·¥ä½œæµã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **è‡ªåŠ¨æ•°æ®å‘ç°**
   - ç›‘æ§æŒ‡å®šç›®å½•çš„æ–‡ä»¶å˜åŒ–
   - è¯†åˆ«æ–°å¢çš„NetCDFæ–‡ä»¶
   - æ”¯æŒé€’å½’ç›®å½•æ‰«æ

2. **æ™ºèƒ½å…ƒæ•°æ®æå–**
   - æå–æ—¶ç©ºèŒƒå›´ä¿¡æ¯
   - è¯†åˆ«å˜é‡å’Œç»´åº¦
   - æå–æ•°æ®è´¨é‡æŒ‡æ ‡

3. **æ•°æ®è´¨é‡æ£€æŸ¥**
   - æ–‡ä»¶å®Œæ•´æ€§éªŒè¯
   - æ•°æ®èŒƒå›´åˆç†æ€§æ£€æŸ¥
   - æ—¶é—´åºåˆ—è¿ç»­æ€§æ£€æŸ¥

4. **ç´¢å¼•ç®¡ç†**
   - è‡ªåŠ¨æ›´æ–°SQLiteç´¢å¼•
   - æ”¯æŒå¢é‡æ›´æ–°
   - æä¾›å¿«é€Ÿæ£€ç´¢æ¥å£

5. **æŠ¥å‘Šç”Ÿæˆ**
   - ç”Ÿæˆæ•°æ®ç»Ÿè®¡æŠ¥å‘Š
   - å¯¼å‡ºCSVè¯¦ç»†æ¸…å•
   - æä¾›Webç•Œé¢æŸ¥çœ‹

### å·¥ä½œæµå®šä¹‰ç¤ºä¾‹
```yaml
name: "ocean_data_management"
description: "æµ·æ´‹ç¯å¢ƒæ•°æ®è‡ªåŠ¨ç®¡ç†å·¥ä½œæµ"
steps:
  - id: "scan_directory"
    operation: "data_access.scan_directory"
    inputs:
      path: "${request.data_path}"
    
  - id: "extract_metadata"
    operation: "metadata.extract_batch"
    depends_on: ["scan_directory"]
    inputs:
      files: "${scan_directory.result.files}"
    
  - id: "quality_check"
    operation: "data_access.quality_check"
    depends_on: ["extract_metadata"]
    inputs:
      metadata: "${extract_metadata.result}"
    
  - id: "update_index"
    operation: "metadata.update_index"
    depends_on: ["quality_check"]
    inputs:
      metadata: "${quality_check.result.valid_metadata}"
    
  - id: "generate_report"
    operation: "reporting.generate_summary"
    depends_on: ["update_index"]
    inputs:
      statistics: "${update_index.result.statistics}"
```

## æ—¶é—´è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ4-6å‘¨ï¼‰ï¼šå®Œæˆç¬¬2å±‚
- å‘¨1-2ï¼šTaskDispatcher å®ç°
- å‘¨3-4ï¼šæ•°æ®ç®¡ç†å·¥ä½œæµå®ç°
- å‘¨5-6ï¼šç½‘ç»œæ¥å£é›†æˆå’Œæµ‹è¯•

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3å‘¨ï¼‰ï¼šå®Œå–„ç¬¬4å±‚
- ç“¦ç‰‡æœåŠ¡å®Œæ•´å®ç°
- æ•°æ®å¯è§†åŒ–åŠŸèƒ½

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šå®Œå–„ç¬¬1å±‚
- ç½‘ç»œæœåŠ¡å®Œæ•´é›†æˆ
- ç³»ç»Ÿæ•´ä½“æµ‹è¯•

## æˆåŠŸæ ‡å‡†

### ç¬¬2å±‚å®Œæˆæ ‡å‡†
1. âœ… å¯ä»¥é€šè¿‡HTTP APIå¯åŠ¨æ•°æ®ç®¡ç†å·¥ä½œæµ
2. âœ… å·¥ä½œæµèƒ½å¤Ÿå¼‚æ­¥æ‰§è¡Œå¹¶æŠ¥å‘Šè¿›åº¦
3. âœ… æ”¯æŒå·¥ä½œæµçš„å–æ¶ˆå’ŒçŠ¶æ€æŸ¥è¯¢
4. âœ… èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®ç›®å½•ï¼ˆ1000+æ–‡ä»¶ï¼‰

### æµ·æ´‹æ•°æ®ç®¡ç†åŠŸèƒ½å®Œæˆæ ‡å‡†
1. âœ… è‡ªåŠ¨æ‰«æå’Œç´¢å¼•NetCDFæ–‡ä»¶
2. âœ… ç”Ÿæˆå®Œæ•´çš„å…ƒæ•°æ®æ•°æ®åº“
3. âœ… æä¾›RESTful APIæŸ¥è¯¢æ¥å£
4. âœ… ç”Ÿæˆè¯¦ç»†çš„æ•°æ®ç»Ÿè®¡æŠ¥å‘Š
5. âœ… æ”¯æŒå¢é‡æ›´æ–°å’Œç›‘æ§

## é£é™©å’Œç¼“è§£æªæ–½

### ä¸»è¦é£é™©
1. **å·¥ä½œæµå¼•æ“å¤æ‚æ€§**ï¼šå¼‚æ­¥æ‰§è¡Œå’Œä¾èµ–ç®¡ç†å¤æ‚
2. **å¤§æ•°æ®å¤„ç†æ€§èƒ½**ï¼šå¤„ç†å¤§é‡æ–‡ä»¶æ—¶çš„å†…å­˜å’Œæ€§èƒ½é—®é¢˜
3. **é”™è¯¯å¤„ç†**ï¼šå·¥ä½œæµä¸­æŸä¸ªæ­¥éª¤å¤±è´¥çš„å¤„ç†æœºåˆ¶

### ç¼“è§£æªæ–½
1. **åˆ†é˜¶æ®µå®ç°**ï¼šå…ˆå®ç°ç®€å•çš„çº¿æ€§å·¥ä½œæµï¼Œå†æ·»åŠ å¤æ‚ä¾èµ–
2. **æµå¼å¤„ç†**ï¼šä½¿ç”¨åˆ†æ‰¹å¤„ç†é¿å…å†…å­˜é—®é¢˜
3. **å®Œå–„æµ‹è¯•**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½è¦æœ‰å……åˆ†çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šTaskDispatcher çš„å®ç°
2. **å¹¶è¡Œè¿›è¡Œ**ï¼šæ•°æ®ç®¡ç†å·¥ä½œæµçš„è®¾è®¡
3. **æŒç»­é›†æˆ**ï¼šç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½èƒ½ä¸ç°æœ‰æ¨¡å—æ­£ç¡®é›†æˆ 